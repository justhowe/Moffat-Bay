<!DOCTYPE html>
<html>
<head>
    <title>Moffat Bay Demo Example</title>
</head>
<body>
<h2>Moffat Bay Demo Example</h2>

<!-- Example of calling a GET api and dynamically building a table-->
<button id="getRoomsButton">Get Rooms</button>
<table border="1" id="roomsTable">
    <thead>
    <tr id="roomsHeaderRow">
    </tr>
    </thead>
    <tbody id="roomsList">
    </tbody>
</table>
<script type="module">
    import { MoffatJSClient } from "./scripts/api/MoffatJSClient.mjs";
    const client = new MoffatJSClient()

    document.getElementById('getRoomsButton').addEventListener('click', async function () {
        // call backend for rooms data
        const roomDataList = await client.getAllRooms();

        // show no data if theres none in response
        if (roomDataList.length === 0) {
            return;
        }
        // build table headers of json response key names
        const keys = Object.keys(roomDataList[0]); // we can convert these from camelCase to natural later
        const headerRow = document.getElementById('roomsHeaderRow');
        headerRow.innerHTML = '';
        keys.forEach((key) => {
            const th = document.createElement('th');
            th.textContent = key;
            headerRow.appendChild(th);
        });

        // put the values from the json response in the rows
        const tableBody = document.getElementById('roomsList');
        tableBody.innerHTML = '';

        roomDataList.forEach((room) => {
            const row = tableBody.insertRow();
            keys.forEach(key => {
                const cell = row.insertCell();
                cell.textContent = room[key];
            });
        });
    });
</script>

<p></p><p></p>

<button id="getReservationsButton">Get Reservations</button>
<table border="1" id="reservationsTable">
    <thead>
    <tr id="reservationsHeaderRow">
    </tr>
    </thead>
    <tbody id="reservationsList">
    </tbody>
</table>

<script type="module">
    // same deal as with rooms table
    import { MoffatJSClient } from "./scripts/api/MoffatJSClient.mjs";
    const client = new MoffatJSClient()

    document.getElementById('getReservationsButton').addEventListener('click', async function () {
        const reservationsList = await client.getAllReservations();

        if (reservationsList.length === 0) {
            return;
        }

        // flatten nested json, we could reuse this in './scripts/
        const flatten = (object) => {
            let flat = {}

            for (const key of Object.keys(object)) {
                if (typeof object[key] === "object") {
                    const recursed = flatten(object[key])
                    flat = { ...flat, ...recursed}
                } else {
                    flat[key] = object[key]
                }
            }
            return flat
        }

        let objects = reservationsList.map((res) => {
            return flatten(res)
        })
        console.log(objects)

        const keys = Object.keys(objects[0]);
        const headerRow = document.getElementById('reservationsHeaderRow');
        headerRow.innerHTML = '';

        keys.forEach(key => {
            const th = document.createElement('th');
            th.textContent = key;
            headerRow.appendChild(th);
        });

        const tableBody = document.getElementById('reservationsList');
        tableBody.innerHTML = '';

        objects.forEach(room => {
            const row = tableBody.insertRow();
            keys.forEach(key => {
                const cell = row.insertCell();
                cell.textContent = room[key];
            });
        });
    });
</script>

<p></p><p></p>

<h2>Password Input Form</h2>
<form id="passwordForm">
    <label for="password">Password:</label>
    <input type="password" id="password" name="password" placeholder="Enter your password" required>
    <br><br>
    <input id="passwordInput" type="button" value="Submit">
</form>
<table border="1" id="passworOutputTable">
    <thead>
    <tr>
        <th>Plaintext</th>
        <th>Hashed</th>
    </tr>
    </thead>
    <tbody id="passwordOutputBody">
    </tbody>
</table>


<script type="module">
    import { hashPassword } from './scripts/util/PasswordHasher.mjs'

    document.getElementById("passwordInput").addEventListener('click', async function (event) {
        event.preventDefault();
        const plaintext = document.getElementById("password").value
        const hashedPassword = await hashPassword(plaintext)

        const tableBody = document.getElementById("passwordOutputBody");

        tableBody.innerHTML = '';

        const row = tableBody.insertRow();
        const cell1 = row.insertCell(0);
        const cell2 = row.insertCell(1);

        cell1.textContent = plaintext
        cell2.textContent = hashedPassword
    })
</script>



</body>
</html>
